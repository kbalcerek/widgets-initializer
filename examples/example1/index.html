<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div id="root">
    <div widget="widgets/a">
      A
      <div widget="widgets/b">
        B
        <div widget="widgets/c">C</div>
      </div>
    </div>
    <div widget="widgets/e">
      E
      <div>
        <div widget="widgets/c">C</div>
      </div>
    </div>
    <div></div>
    <div>
      <div widget="widgets/c">C</div>
    </div>
    <div>
      <div>
        <div widget="widgets/c">C</div>
      </div>
    </div>
    <div widget="widgets/c">C</div>
    <div widget="widgets/a">
      A
      <div widget="widgets/with-other-widget-markup">with-other-widget-markup</div>
    </div>
    <a widget="widgets/d">D</a>
  </div>

  <div class="controls">
    <button id="init">Init</button>
    <button id="destroy">Destroy</button>
  </div>

  <script src="../../dist/lib.script.js"></script>
  <script>
    document.getElementById('init').addEventListener('click', () => {
      WidgetsInitializer.init(document.getElementById('root'), (errors) => {
        if (errors) {
          console.log('Init completed with errors', errors);
        } else {
          console.log('Init successful');
        }
      }, {
        resolver: (path) => new Promise((resolve, reject) => {
        let relativePart = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));
          import(`${relativePart}/${path}.js`)
            .then((module) => {
              resolve(module);
            })
            .catch((error) => {
              console.error(`App.js: Error loading ${path}: ${error}`);
              reject(error);
            }); 
        })
       });
    });

    document.getElementById('destroy').addEventListener('click', () => {
      WidgetsInitializer.destroy(document.getElementById('root'));
    });
  </script>
</body>

</html>